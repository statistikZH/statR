#' insert_index_sheet()
#'
#' @description Function which generates an index sheet inside an openxlsx workbook.
#' @param wb A workbook object as generated by openxlsx::createWorkbook()
#' @param logo Either statzh or zh, or path to logo file
#' @param contact Either "statzh" or a character string
#' @param homepage statzh or a character string with the URL
#' @param openinghours statzh or a character string or vector with opening hours
#' @param titlesource Character vector denoting the data source
#' @param auftrag_id Order ID
#' @param maintitle Main title
#' @keywords datasetsXLSX
insert_index_sheet <- function(wb, logo, contact, homepage, openinghours,
                               titlesource, auftrag_id, maintitle){

  # Hardcoded ----------
  index_sheet_name <- "Inhalt"
  toc_caption <- "Inhalt"


  # Initialize new worksheet as index sheet ------
  openxlsx::addWorksheet(wb, index_sheet_name)


  # Process input (substitute default values) -----
  contactdetails <- inputHelperContactInfo(contactdetails)


  # Determine start/end rows of content blocks -----
  contact_start_row <- 2
  contact_end_row <- contact_start_row + length(c(contact, homepage))
  request_start_row <- contact_end_row + 2
  title_start_row <- request_start_row + 2
  source_start_row <- title_start_row + 1
  index_start_row <- source_start_row + 2


  # Insert logo ----------
  logo <- inputHelperLogoPath(logo)

  if (!is.null(logo)){
    openxlsx::insertImage(wb, index_sheet_name, logo, 2.145, 0.7865, "in")
  }


  # Insert contact info, title, metadata, and sources into worksheet --------

  ### Contact information
  contact_info <- c(contact, inputHelperHomepage(homepage))
  openxlsx::writeData(wb, index_sheet_name, contact_info, xy = c("O", contact_start_row))

  ### Office hours
  openxlsx::writeData(wb, index_sheet_name, inputHelperOfficeHours(openinghours), xy = c("R", contact_start_row))

  ### Request information
  request_info <- c(inputHelperDateCreated(prefix = "Erstellt am: "),
                    inputHelperOrderNumber(auftrag_id, prefix = "Auftragsnr.:"))

  openxlsx::writeData(wb, index_sheet_name, request_info, xy = c("O", request_start_row))

  ### Title
  openxlsx::writeData(wb, index_sheet_name, maintitle, xy = c("C", title_start_row))
  openxlsx::addStyle(wb, index_sheet_name, style_maintitle(), title_start_row, 3)

  ### Source
  openxlsx::writeData(wb, index_sheet_name, source, xy = c("C", source_start_row))

  ### Table of content caption
  openxlsx::writeData(wb, index_sheet_name, toc_caption, xy = c("C", index_start_row))
  openxlsx::addStyle(wb, index_sheet_name, subtitleStyle(), index_start_row, 3)


  # Format ---------

  ### Set column width of first column to 1
  openxlsx::setColWidths(wb, index_sheet_name, 1, 1)

  ### Hide gridlines
  openxlsx::showGridLines(wb, index_sheet_name, FALSE)

  ### Add Headerline
  openxlsx::addStyle(wb, index_sheet_name, style_headerline(), contact_end_row + 1, 1:20, gridExpand = TRUE, stack = TRUE)

}
